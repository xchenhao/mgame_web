$(function(){function s(s,i,t){var o=i.next("span.re_tips_charge");t=1e3*t||3200,o.is(":visible")?o.animate({opacity:"0.2"},100).animate({opacity:"1"},100).animate({opacity:"0.2"},50).animate({opacity:"1"},50):(o.html(s).fadeIn(200),setTimeout(function(){o.fadeOut("fast")},t+200))}function i(){$(".prov-span").addClass("prov-select").html('请选择省份<i class="prov-list-on"></i>').siblings().removeClass("prov-select"),$(".city-span").html('请选择城市<i class="prov-list-out"></i>'),$(".town-span").html('请选择县区<i class="prov-list-out"></i>'),$(".prov-box").show(),$(".prov-box").siblings().hide()}function t(s,i){$.ajax({type:"GET",url:"http://my.okhqb.com/my/queryRegion.json?regionId="+s,dataType:"jsonp",jsonpCallback:"callback",success:function(s){if(200==s.code){var t="<p>",o=0,a=s.data.length;if(0>=a)return void $(".province-list").hide();for(;a>o;o++)t+='<span data-value="'+s.data[o].regionId+'">'+s.data[o].regionName+"</span>";t+="</p>",i.html(t)}}})}function o(){var s,o=$("input[name=addressId]:checked");o.length<=0&&$(".cancel").hide(),$(".province-select,#region_province").click(function(){i(),$(".province-list").toggle()}),$(".prov-list-span").click(function(){$(this).addClass("prov-select").siblings().removeClass("prov-select"),$(this).find("i").removeClass("prov-list-out").addClass("prov-list-on"),$(this).siblings().find("i").removeClass("prov-list-on").addClass("prov-list-out"),$(this).hasClass("prov-span")?($(".prov-box").show(),$(".prov-box").siblings().hide()):$(this).hasClass("city-span")?($(".city-box").show(),$(".city-box").siblings().hide()):($(".town-box").show(),$(".town-box").siblings().hide())}),$(".prov-box span").click(function(){var s=$(this).attr("data-value"),i=$(this).html();$("#region_province").val(i),$(".prov-span").html(i+'<i class="prov-list-on"></i>'),$(".city-box").show(),$(".city-box").siblings().hide(),$(".city-span").html('请选择城市<i class="prov-list-on"></i>'),$(".city-span").addClass("prov-select").siblings().removeClass("prov-select"),$(".city-span").find("i").removeClass("prov-list-out").addClass("prov-list-on"),$(".city-span").siblings().find("i").removeClass("prov-list-on").addClass("prov-list-out"),$(".save-addr").data("addressId",s),t(s,$(".city-box")),$("#regionId").val(s)}),$(".city-box span").live("click",function(){var i=$(this).attr("data-value"),o=$(this).html(),a=$("#region_province").val();s=i,a=a.split(" "),a[1]=o,a[2]="",$("#region_province").val(a.join(" ")),$(".city-span").html(o+'<i class="prov-list-on"></i>'),$(".town-box").show(),$(".town-box").siblings().hide(),$(".town-span").html('请选择县区<i class="prov-list-on"></i>'),$(".town-span").addClass("prov-select").siblings().removeClass("prov-select"),$(".town-span").find("i").removeClass("prov-list-out").addClass("prov-list-on"),$(".town-span").siblings().find("i").removeClass("prov-list-on").addClass("prov-list-out"),$(".save-addr").data("addressId",i),$("#regionId").val(i),t(i,$(".town-box"))}),$(".town-box span").live("click",function(){var i=$(this).html(),t=$("#region_province").val(),o=$(this).attr("data-value");s=o,t=t.split(" "),t[2]=i,$(".save-addr").data("addressId",o),$("#region_province").val(t.join(" ")),$(".province-list").hide(),$("#regionId").val(o)})}$("#region_area,#address,#consignee,#phone,#postalcode,#mobile").after('<span class="re_tips_charge"></span>'),$("#consignee,#mobile,#address").focus(function(){$(this).addClass("clsfocus")}),$("#add_button").bind("click",function(){$("#mobile").val($.trim($("#mobile").val()));var i=$("#consignee"),t=$("#region_area"),o=$("#address"),a=$("#postalcode"),n=$("#mobile"),e=$("#phone"),l=i.val(),r=(t.val(),o.val()),d=a.val(),c=n.val(),v=e.val(),p=$("#regionId").val(),h=/^1[3|4|5|7|8]\d{9}$/,m=/(\d{3}-)(\d{8})$|(\d{4}-)(\d{7})$/;return ckpost=/^\d{6}$/,""==l||l.length<2||l.length>15?(s("请输入姓名，长度必须在2-15个字符之间！",i,5),!1):void(""==p||"0"==p?s("请选择省份和城市！",t):""==r?s("请填写您的收货地址！",o):r.length>50||r.length<5?s("地址长度在5-50个字符之间！",o):""==d||ckpost.test(d)?""==c?s("请输入您的手机号码！",n):h.test(c)?""==v||m.test(v)?$("#addressForm").submit():s("固定电话格式如 0755-83278888",e,5):s("请填写正确的手机号码！",n):s("邮编格式不正确！",a))}),$(".MidAddDel").click(function(){var s=$(this).attr("sel");art.dialog({title:"删除地址",content:"您确定要删除吗？",ok:function(i){$.post(myServer+"/my/deleteAddress.json",{addressId:s},function(s){200==s.code?location.href=myServer+"/my/address.html":art.dialog({title:!1,content:s.msg,noFn:!0,time:2,icon:"warning_s"})})},cancel:!0})}),$(".addr_default").click(function(){var s=$(this).attr("sel");$(this);$.post(myServer+"/my/setDefaultAddr.json",{addressId:s},function(s){200==s.code?location.href=myServer+"/my/address.html":art.dialog({title:!1,content:s.msg,noFn:!0,time:2,icon:"warning_s"})})}),$(".addr_default").parents("tr").hover(function(){$(this).find(".addr_default").toggle()}),o()});