!function(t){t.fn.selectDown=function(e){return this.each(function(){var n=t(this),a=t(".mod-select-input",n),i=t('input[type="text"]',n),o=t('input[type="hidden"]',n),s=t(".mod-select-list",n),c=t("li",n),l=!0,r=n.parent(),d=function(){l=!0,s.hide(),r.css("z-index",0)},h=function(){l=!1,r.css("z-index",2),s.show()};a.click(function(t){return n.siblings().find(".mod-select-list").hide(),c.length&&l?h():d(),!1}),r.mouseleave(function(){return d(),!1}),n.on("click","li",function(){var a=t(this);return i.val(t.trim(a.text())),o.length?o.val(a.data("val")):"",a.addClass("on").siblings().removeClass("on"),d(),e&&"function"==typeof e&&e.apply(n[0]),!1}),t(document).click(function(){d()})})}}(jQuery),$(function(){function t(t,e,n,a){var i=e.next("span.re_tips_charge");$.isFunction(n)?(a=n,n=3200):n=1e3*n,i.is(":visible")?i.animate({opacity:"0.2"},100).animate({opacity:"1"},100).animate({opacity:"0.2"},50).animate({opacity:"1"},50,function(){a&&$.isFunction(a)?a():""}):(i.html(t).fadeIn(200),i.css("display","inline-block"),setTimeout(function(){i.fadeOut("fast",function(){a&&$.isFunction(a)?a():""})},n+200))}function e(){$(".rule_btn").click(function(){$(".rulesLayer").show()}),$(".hd").click(function(){$(".rulesLayer").hide()}),$("#sign_btn").click(function(){if(!$(this).hasClass("sign_out")){var t=$("#mytoken"),e=$.trim(t.val());$.ajax({url:"http://my.okhqb.com/my/checkin.json",dataType:"jsonp",jsonp:"callback",data:{_hqb_token:e},success:function(e){if(t.val(e.formToken||""),200===e.code){var n=e.data.checkInInfoDo,a=$(".u_points a").html(),i=$(".sign_points");a=Number(a)+Number(n.score),o(i,4,function(t){var e=$('<b class="addScore">+'+n.score+"</b>");e.css({top:t.top,left:t.left+60}),$("body").append(e),e.animate({top:t.top-50,opacity:0},2e3,function(){$(this).remove()})}),$(".sign_days").html("已经连续签到"+n.persistentTimes+"天"),$(".sign_tips").html("已领小强币"),$(".sign_points").html(n.score),$(".u_points a").html(a),$("#point_msg").html(a),n.persistentTimes<6&&$(".sign_note").html('明天签到可领<b class="sign_note_couts">'+5*(n.persistentTimes+1)+"</b>"),$(".mod_list li").eq(n.persistentTimes--).addClass("sign_over"),$("#sign_btn").attr("class","sign_out")}else 701232===e.code?art.dialog({id:"checkPhone",title:"验证手机",content:'<div id="checkPhone"><form action=""><h3>亲，您还没验证手机哦，请先验证手机！</h3><div class="fm_item"><label for="">请输入新手机号码：</label><input type="text" name="" id="phoneNum" class="phoneNum fm_int" maxlength="11" /><a class="get_btn" href="javascript:;">获取验证码</a><p class="time_down">没收到短信？<b>60</b>秒后 <a href="javascript:;" class="resend_btn">重发一次</a></p><p class="tips"></p></div><div class="fm_item"><label for="">请输入短信验证码：</label><input type="text" name="" id="authCode" class="authCode fm_int" maxlength="6" /><a class="check_btn" href="javascript:;">验证</a><p class="tips"></p></div></form></div>'}):590===e.code?OKHQB_sign.dialog({sign_in_callback:function(){window.location.href=window.location.href}}):art.dialog({title:"系统消息",content:e.msg})},error:function(){art.dialog({title:"系统消息",content:"签到失败，请稍后重试"})}})}})}function n(t){var e=/^1[3|4|5|7|8]\d{9}$/,n=$.trim(t.val());return e.test(n)}function a(){var t=60,e=null;e=setInterval(function(){t--,$(".time_down b").html(t),0==t&&(clearInterval(e),$("#checkPhone .get_btn").addClass("get_btn_active"),$("#checkPhone .resend_btn").addClass("resend_btn_yes"),showBlue=1)},1e3)}function i(t){var e=$("#mytoken"),n=$.trim(e.val())||"";$("#checkPhone .get_btn").removeClass("get_btn_active"),$("#checkPhone .resend_btn").removeClass("resend_btn_yes"),$.ajax({url:d+"/my/sendbindtel.json",data:{_hqb_token:n,tel:t},dataType:"jsonp",jsonp:"callback",success:function(t){200===t.code?($(".time_down").show(),a()):500===t.code?art.dialog({title:!1,content:t.msg,noFn:!0,time:3,icon:"error_s"}):art.dialog({title:!1,content:t.msg,noFn:!0,time:3,icon:"error_s",close:function(){location.reload()}});var n=t.formToken||"";e.val(n)}})}function o(t,e,n){var a=($(".user_Info"),$('<img class="flyGold" src="http://s1.hqbcdn.com/assets/v3/images/member/gold.png" alt="" />')),i=$(".u_points").offset(),s=t.offset();if(a.css({position:"absolute",top:s.top,left:s.left}),$("body").append(a),$.isFunction(e)&&(n=e,e=1),a.animate({left:i.left+50,top:i.top-50,width:parseInt(a.width()/2),height:parseInt(a.height()/2)},function(){$(this).animate({top:i.top+20,left:i.left+70,width:parseInt(a.width()/4),height:parseInt(a.height()/4),opacity:0},function(){$(this).fadeOut().remove()})}),e--,e){setTimeout(function(){o(t,e,n)},70-e)}else n&&"function"==typeof n&&n(i)}function s(t,e){return"魔羯水瓶双鱼牡羊金牛双子巨蟹狮子处女天秤天蝎射手魔羯".substr(2*t-2*(e<"102223444433".charAt(t-1)- -19),2)}function c(t){$.ajax({type:"GET",dataType:"jsonp",url:"http://my.okhqb.com/my/pointDetail.json?"+t,jsonpCallback:"callback",success:function(t){if(200==t.code)if(t.data){for(var e="",n=$("#isNull").val(),a=0,i=t.data.length;i>a;a++)e+="<tr><td>"+t.data[a].gmtCreated+"</td><td>"+t.data[a].score+"</td><td>"+t.data[a].scoreName+"</td><td>"+t.data[a].actionName+"</td><td>"+t.data[a].description+"</td></tr>";20==t.data.length&&(e+='<tr><td colspan="5"><button id="load_more_info" data-page='+$("#load_more_info").attr("data-page")+">加载更多</button></td></tr>"),"false"==n?$(".intergal_table tr:first").siblings().remove():"true"==n&&$(".intergal_table tr:last").remove(),$(e).insertAfter($(".intergal_table tr:last"))}else{var n=$("#isNull").val();if("false"==n){$(".intergal_table tr:first").siblings().remove();var e='<tr style="height:100px; font-size:14px;"><td colspan="5">没有相关的明细记录</td></tr>';$(e).insertAfter($(".intergal_table tr:first"))}else"true"==n&&$("#load_more_info").hide()}else art.dialog({title:"",padding:"0",content:'<div style="border:2px solid #1292dc; height:100px; width:400px; line-height:100px; text-align:center; font-size:14px; font-wight:bold;color:#f00;">'+t.msg+"</div>",height:"100px",width:"400px",lock:!0,fixed:!0})}})}function l(t){var e=$(".income_select").children(":selected").val(),n=$(".cost_type_select").children(":selected").val(),a=$("#start_date").val(),i=$("#end_date").val();if(""!=a&&""!=i){if(a.replace("-","")>i.replace("-",""))return void art.dialog({title:"",padding:"0",content:'<div style="border:2px solid #1292dc; width:300px; height:80px; line-height:80px; text-align:center; font-size:14px; font-wight:bold;color:#f00;">请选择正确的开始与结束日期!</div>',height:"80px",width:"300px",lock:!0,fixed:!0});var o="scoreType="+e+"&actionType="+n+"&startTime="+a+"&endTime="+i+"&pageNo="+parseInt(t)+"&pageSize=20";c(o)}}function r(t,e,n){function a(){var t=Math.floor(5*Math.random());return systemTime>deadline&&(t=Math.floor(3*Math.random())),t}var i=null;textLib=["拼一拼，强币变现金","小强币抽奖，百万红包等您拿","包剪锤擂台，玩游戏赚强币","豪赌世界杯，猜冠军赢大奖","召唤章鱼帝，怒夺1个亿"],deadline=new Date("2014/7/13/00:00:00").getTime(),systemTime=(new Date).getTime(),art.dialog({title:"",padding:"0px 0px",content:'<div id="scoreLayer"><img class="pic" width="205" height="185" src="http://s1.hqbcdn.com/assets/v3/images/member/tipLayer_bg.png" alt="" /><dl><dt>'+t+'成功<br/>获得<span class="score">'+e+'小强币</span></dt><dd><span class="time">10</span>秒自动关闭<br><a target="_blank" class="accessCoin" href="http://du.okhqb.com/">'+textLib[a()]+"</a></dd></dl></div>",height:"185px",init:function(){var t=this,e=10,n=function(){$("#scoreLayer .time").text(e),!e&&t.close(),e--};i=setInterval(n,1e3)},close:function(){clearInterval(i),n&&"function"==typeof n&&n()}})}var d="http://my.okhqb.com";e(),$("#phoneNum").live("keyup",function(){n($("#phoneNum"))?$("#checkPhone .get_btn").addClass("get_btn_active"):$("#checkPhone .get_btn").removeClass("get_btn_active")}),$("#checkPhone .get_btn_active, #checkPhone .resend_btn_yes").live("click",function(){var t=$.trim($("#phoneNum").val());i(t)}),$("#authCode").live("keyup",function(){var t=$.trim($(this).val());/^\d{6}$/.test(t)?$("#checkPhone .check_btn").addClass("check_btn_active"):$("#checkPhone .check_btn").removeClass("check_btn_active")}),$(".check_btn_active").live("click",function(){var t=$(".check_btn"),e=$.trim($("#authCode").val()),n=$("#mytoken");if(""===e)$(this).siblings(".tips").html("请输入验证码！").show();else{var a=n.val()||"";$("#checkPhone .check_btn").removeClass("check_btn_active"),$.ajax({url:d+"/my/viladbindtel.json",data:{_hqb_token:a,randCode:e},dataType:"jsonp",jsonp:"callback",success:function(e){200==e.code?e.data.score?(art.dialog.get("checkPhone").close(),r("绑定手机",e.data.score)):art.dialog({title:!1,content:'<p style="font-size:16px">绑定手机成功！</p>',noFn:!0,time:2,padding:"30px 50px",icon:"succeed",cancel:!1,close:function(){art.dialog.get("checkPhone").close()}}):(t.siblings(".tips").html(e.msg).show(),art.dialog.get("checkPhone").time(2)),a=e.formToken||"",n.val(a)}})}});var h=function(t,e){var n="";try{$.ajax({url:"http://my.okhqb.com/my/queryRegion.json",dataType:"jsonp",jsonp:"callback",data:{regionId:e},success:function(e){200===e.code&&e.data&&($.each(e.data,function(t,e){n+='<li data-val="'+e.regionId+'">'+e.regionName+"</li>"}),t.append(n))}})}catch(a){art.dialog({title:"提示",time:3,content:"加载地址失败，请重试"})}};$("#province").parents(".mod-select").each(function(){var t=$(".mod-select-list ul",$(this));h(t,0)}),$("#province, #city").parents(".mod-select").selectDown(function(){var t=$(this).next(".mod-select"),e=$(".mod-select-list ul",t),n=($('input[type="text"]',t),$.trim($(this).find("li.on").attr("data-val"))),a=$(this).nextAll(".mod-select");a.each(function(){var t=$('input[type="text"]',this),e=$(".mod-select-list li",this).filter(":first");t.val(e.text())}),a.find(".mod-select-list ul").each(function(){$(this).children().not(":eq(0)").remove()}),0!=n&&h(e,n)}),$(".extend_info .mod-select").selectDown(),$("#birthDayConstellation").click(function(){var t=$(this);WdatePicker({el:$dp.$("birthDay"),onpicking:function(e){var n=e.cal.getNewDateStr()+","+s($dp.cal.getNewP("M"),$dp.cal.getNewP("d"))+"座";this.value=e.cal.getNewDateStr(),t.val(n)}})}),$("#nickname").change(function(){var t=$("#mytoken"),e=$(this),n=$.trim(t.val()),a=$.trim(e.val());e.siblings(".t_err").remove(),$.ajax({url:"http://my.okhqb.com/my/checknickname.json",data:{nickname:a,_hqb_token:n},success:function(n){switch(t.val(n.formToken||""),n.code){case 200:e.data("verify",!0);break;case 10719:case 10809:e.parent().append('<span class="t_err">'+n.msg+"</span>"),e.data("verify",!1);break;default:art.dialog({title:"系统提示",time:2,content:n.msg})}}})}),$(".tb_vip_wrap .saveBtn").click(function(){var e=$("#realName"),n=$("#nickname"),a=$("#mytoken"),i=$(this),o=$.trim(e.val()),s=$.trim(n.val());e.parent().find(".t_err").remove();var c=function(){$("#updateMemberForm").ajaxSubmit({url:"http://my.okhqb.com/my/updateAccountInfo.json",success:function(e){a.val(e.formToken||""),200===e.code&&(e.data.score?r("完善信息",e.data.score,function(){location.reload()}):t("修改成功！",i,function(){location.reload()}))}})};if(n.length){var l=!0;""===s&&(l=!1),""===o&&(l=!1,e.parent().append('<span class="t_err">请填写真实姓名</span>')),l&&(n.data("verify")?c():s===n[0].defaultValue?c():"")}else""!==o?c():e.parent().append('<span class="t_err">请填写真实姓名</span>');return!1});var p=!1;$(window).scroll(function(){$(this).scrollTop()>100?0==p&&(p=!0):1==p&&(p=!1)}),$(".intergal_pic").bind("mouseover mouseout",function(t){"mouseover"==t.type?($(this).children(".intergal_pic_show").hide(),$(this).children(".intergal_box").show()):"mouseout"==t.type&&($(this).children(".intergal_pic_show").show(),$(this).children(".intergal_box").hide())}),$("#start_date,#end_date").bind("click",function(){WdatePicker({dateFmt:"yyyy-MM-dd",readOnly:!0,onpicked:function(){$("#isNull").val(!1),$("#_pageNo").val("1"),l($("#_pageNo").val())}})}),$(".income_select").bind("change",function(t){$("#isNull").val(!1),$("#_pageNo").val("1"),l($("#_pageNo").val())}),$("#load_more_info").live("click",function(){$("#isNull").val(!0);var t=parseInt($("#_pageNo").val());t++,$("#_pageNo").val(t),l(t)}),$(".cost_type_select").bind("change",function(t){$("#isNull").val(!1),$("#_pageNo").val("1"),l($("#_pageNo").val())})});