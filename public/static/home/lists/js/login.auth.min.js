var Auth=window.Auth||{};Auth={init:function(){this.DiscusionTimer=null;var s=this.getAuthInfo();s&&this.renderingLoginBar(s),this.msgHover(),this.gotoLogin()},getAuthInfo:function(){var s=$.cookie("auth"),t=$.cookie("session");if(!s||!t)return null;_auth=$.parseJSON(s);try{returnValue=$.parseJSON(_auth)}catch(o){returnValue=null}return returnValue},renderingLoginBar:function(s){var t=$(".pro-tool-status");if(!s)return void $.ajax({url:"http://login.okhqb.com/member/getLoginInfo.json?callback=?",dataType:"json",success:function(s){if(200==s.code){Auth.getMsg();var o=$.parseJSON(s.data);if(0==o.logined)_unLoginBar.show(),_loggedBar.hide();else{var e=o.nickname,i="";7==o.sys_register&&(e=o.mobile),1==o.member_type?i="http://my.okhqb.com/my/home.html?ad=dd_id":5==o.member_type&&(i="http://my.okhqb.com/my/order.html"),t.html('华强北商城欢迎您：<a href="'+i+'" target="_blank" class="tool-bold-red">'+e+'</a>&nbsp;&nbsp;&nbsp;<a href="http://www.okhqb.com/member/logout" class="logout">[退出]</a>'),$(".dc-nav-user").html(e),$(".dc-unlogin").hide(),$(".dc-logined").show()}}}});this.getMsg();var o=s.nickname,e="";7==s.sys_register&&(o=s.mobile),1==s.member_type?e="http://my.okhqb.com/my/home.html?ad=dd_id":5==s.member_type&&(e="http://my.okhqb.com/my/order.html"),t.html('华强北商城欢迎您：<a href="'+e+'" target="_blank" class="tool-bold-red">'+o+'</a>&nbsp;&nbsp;&nbsp;<a href="http://www.okhqb.com/member/logout" class="logout">[退出]</a>'),$(".dc-nav-user").html(o),$(".dc-unlogin").hide(),$(".dc-logined").show()},gotoLogin:function(){$(".pro-login").click(function(){OKHQB_sign.dialog({sign_in_callback:function(){window.location.reload()}})})},autoLogin:function(){var s=window.location.href;!$.cookie("auth")&&$.cookie("okhqb_auto_login")&&$.cookie("auto_login_member_id")&&s.indexOf("logincallback")<0&&s.indexOf(".json")<0&&(window.location="http://login.okhqb.com/member/autoLogin.html?forward="+window.location.href)},getMsg:function(){$.ajax({url:"http://my.okhqb.com/my/message/unread.json",dataType:"jsonp",jsonpCallbak:"callback",success:function(s){200==s.code&&$(".nav-message").html(s.data)}})},getDisMsg:function(){$.ajax({url:"http://my.okhqb.com/my/message/unreadDiscussion.json",dataType:"jsonp",jsonpCallbak:"callback",success:function(s){200==s.code&&Auth.showDiscusonMsg(s.data)}})},showDiscusonMsg:function(s){if(s>0){if($(".dis-msg-remind").length>0)$(".dis-msg-num").html(s);else{var t=($(".tel-phone").position(),'<div class="dis-msg-remind" style="right:0px;top:36px;">');t+='<div class="dis-msg-close">╳</div>',t+='<div class="dis-msg-l">',t+='<span class="dis-msg-num">'+s+"</span></div>",t+='<p>你有<i class="dis-msg-num">'+s+"</i>条新评论</p>",t+='<p><a href="http://my.okhqb.com/my/comments/replyMeList.html" target="_blank">查看评论&nbsp;〉</a></p></div>',$(".toolbar").append(t)}$(".dis-msg-close").live("click",function(){$(".dis-msg-remind").remove()})}else $(".dis-msg-remind").remove();clearTimeout(Auth.DiscusionTimer),Auth.DiscusionTimer=setTimeout(function(){Auth.getDisMsg()},3e4)},msgHover:function(){$(".toolbar-right-list li:not(.tel-phone)").hover(function(){$(this).addClass("mouse-on"),$(this).find(".toolbar-right-box").show(),$(this).find(".list-icon-new").css({"background-image":"url(http://s.hqbcdn.com/assets/v4/images/newindex/sprites_index_2.png) ","background-position":"-47px -117px"})},function(){$(this).removeClass("mouse-on"),$(this).find(".toolbar-right-box").hide(),$(this).find(".list-icon-new").css({"background-image":"url(http://s.hqbcdn.com/assets/v4/images/newindex/sprites_index_2.png) ","background-position":"-36px -117px"})}),$(".okhqb-phone").hover(function(){$(".toolbar-days").show()},function(){$(".toolbar-days").hide()});var s=!1;$(".nav-msg").mouseover(function(){return s?!1:(s=!0,setTimeout(function(){s=!1},3e4),$.ajax({type:"GET",url:"http://my.okhqb.com/my/message/subscribeMessages.json",dataType:"jsonp",jsonp:"callback",success:function(s){if(200===s.code){if(""==s.data)return $(".msg-list-box").html('<p style="margin-bottom:10px;line-heihgt:50px; text-align:center;">暂无消息</p>'),!1;var t="<ul>",o=s.data.subscribeOrdersMessages,e=o.length,i=s.data.subscribeGoodsMessages,n=i.length;if(o&&e>0){t+='<li><p class="list-title list-no-top"><i>|</i><span class="msg-list-bold">您购买的商品</span>&nbsp;有<span class="odm">'+e+"</span>个物流变化</p>";for(var a=0;e>a;a++)t+=a!==e-1?'<p class="list-info list-info-border">':'<p class="list-info">',t+='<a href="http://my.okhqb.com/my/order.html?fromTpe=S"><img src="'+o[a].imageUrl+'" width="55" height="50" /></a>',t+='<span><a href="http://my.okhqb.com/my/order.html?fromTpe=S" target="_blank">'+o[a].tradeSn+"</a></span><span>"+o[a].message+"</span>",t+='<a href="javascript:void(0);" data-listNum="'+o[a].messageId+'" data-counts="odm" class="msg-delte">×</a></p>  ';t+="</li>"}if(i&&n>0){t+=0==e?'<li><p class="list-title list-no-top"><i>|</i><span class="msg-list-bold">您关注的商品</span>&nbsp;有<span class="sgm">'+n+"</span>个动态变化</p>":'<li><p class="list-title"><i>|</i><span class="msg-list-bold">您关注的商品</span>&nbsp;有<span class="sgm">'+n+"</span>个动态变化</p>";for(var a=0;n>a;a++)t+=a!==n-1?'<p class="list-info list-info-border">':'<p class="list-info">',t+='<a href="hhttp://my.okhqb.com/my/subscription.html?fromTpe=S"><img src="'+i[a].imageUrl+'" width="55" height="50" /></a>',t+='<a href="http://my.okhqb.com/my/subscription.html?fromTpe=S" target="_blank" class="list-link">'+i[a].skuName+"</a>",t+='<a href="javascript:void(0);" data-listNum="'+i[a].messageId+'" class="msg-delte" data-counts="sgm">×</a></p>  ';t+="</li>"}o&&0==e&&i&&0==n&&(t+='<p style="margin-bottom:5px;width: 100%;line-height: 30px; text-align: center;"><a href="http://my.okhqb.com/my/comments/replyMeList.html" target="_blank" style="display: block;width: 100%;">查看消息</a></p>'),t+="</ul>",$(".msg-list-box").html(t)}}}),void $(".msg-delte").live("click",function(){var t=$(this).attr("data-listNum"),o=$(this),e=$(this).attr("data-counts");$.ajax({type:"GET",url:"http://my.okhqb.com/my/message/unShow.json?messageId="+t,dataType:"jsonp",jsonp:"callback",success:function(t){if(200===t.code){s=!1,o.parent().remove();var i=$("."+e).html(),n=$(".nav-message").html();i--,n--,n=n>0?n:0,$(".nav-message").html(n),$("."+e).html(i)}}})}))})}},$(document).ready(function(){$(".dc-new-phone").hover(function(){var s='<div class="kf-new-time">工作日：9:00-22:00<br/>节假日：9:00-18:00</div>';$(this).after(s)},function(){$(this).next(".kf-new-time").remove()}),Auth.init()});