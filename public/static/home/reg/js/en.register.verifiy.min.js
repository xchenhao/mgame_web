jQuery(function(e){function a(){var a=e("#registerForm").attr("data-type");if("email"==a)var t=["email","nickname","password","confirm","captcha"];else if("phone"==a)var t=["password","confirm","mobile","moblieCaptcha"];for(var s in t)if(!authData[t[s]])return!1;var i=e("#hqb_protocol");return i.parent().find("em").remove(),i.is(":checked")?!0:(i.parent().append('<em class="txtRed">请接受服务条款</em>'),!1)}function t(a){var t=(new Date,e.trim(e("#mytoken").val())),s="mcaptcha"==a?"captcha":a;e("#"+a).parent().find("em").replaceWith('<em class="txtLoad">正在验证...</em>'),e.ajax({url:"/member/check"+s+".json",type:"GET",dataType:"jsonp",jsonp:"callback",data:{val:e("#"+a).val(),regType:e("#regType").val(),_hqb_token:t},success:function(t){"200"==t.code?(e("#"+a).parent().find("em").replaceWith('<em class="txtGre"></em>'),e("#"+a).removeClass("error"),authData[a]=!0,"mcaptcha"==a&&e("#getMoblieCaptcha").removeClass("disabled")):(e("#"+a).addClass("error"),e("#"+a).parent().find("em").replaceWith('<em class="txtRed">'+t.msg+"</em>"),authData[a]=!1,"mcaptcha"==a&&e("#getMoblieCaptcha").addClass("disabled"));var s=t.formToken||"";e("#mytoken").val(s)}})}function s(a){var t=e.trim(e("#mytoken").val()),s=e.trim(e("#mobile").val()),i=e.trim(e("#moblieCaptcha").val());e("#"+a).parent().find("em").replaceWith('<em class="txtLoad">正在验证...</em>'),e.ajax({url:"/member/validateRegisterMobileCaptcha.json",type:"GET",dataType:"jsonp",jsonp:"callback",data:{mobile:s,mobileCaptcha:i,_hqb_token:t},success:function(t){"200"==t.code?(e("#"+a).parent().find("em").replaceWith('<em class="txtGre"></em>'),e("#"+a).removeClass("error"),authData[a]=!0):(e("#"+a).addClass("error"),e("#"+a).parent().find("em").replaceWith('<em class="txtRed">'+t.msg+"</em>"),authData[a]=!1);var s=t.formToken||"";e("#mytoken").val(s)}})}function i(a){var t=["mobile","moblieCaptcha","mcaptcha"],s=["email","nickname","captcha"],i=[],r=[];"email"==a?(i=s,r=t):(i=t,r=s);for(var l in i)e("#"+i[l]).parents("ul").show();for(var m in r)e("#"+r[m]).parents("ul").hide();e("#registerForm").find("input.reVerifiy").val("").removeClass("error").next("em").replaceWith("<em></em>")}function r(){var a=e("#registerForm").attr("data-type"),t=!0;if("email"==a){var s=e("input#email"),i=e("input#nickname"),r=e("input#password"),l=e("input#confirm"),m=e("input#captcha");""==e.trim(s.val())?(s.addClass("error"),s.next().replaceWith("<em class='txtRed'>请填写常用的Email地址</em>"),t=!1):""==e.trim(r.val())?(r.addClass("error"),r.next().replaceWith("<em class='txtRed'>请输入6-16位字符的密码</em>"),t=!1):""==e.trim(l.val())?(l.addClass("error"),l.next().replaceWith("<em class='txtRed'>请再次输入密码</em>"),t=!1):""==e.trim(i.val())?(i.addClass("error"),i.next().replaceWith("<em class='txtRed'>昵称应为2-20个字符</em>"),t=!1):""==e.trim(m.val())&&(m.addClass("error"),m.parent().find("em").replaceWith("<em class='txtRed'>请输入验证码</em>"),t=!1)}else if("phone"==a){var r=e("input#password"),l=e("input#confirm"),n=e("input#mobile"),o=e("input#moblieCaptcha");""==e.trim(n.val())?(n.addClass("error"),n.next().replaceWith("<em class='txtRed'>请填写你的手机号码</em>"),t=!1):""==e.trim(o.val())?(o.addClass("error"),o.next().replaceWith("<em class='txtRed'>请填写手机验证码</em>"),t=!1):""==e.trim(r.val())?(r.addClass("error"),r.next().replaceWith("<em class='txtRed'>请输入6-16位字符的密码</em>"),t=!1):""==e.trim(l.val())&&(l.addClass("error"),l.next().replaceWith("<em class='txtRed'>请再次输入密码</em>"),t=!1)}return t}window.authData={email:!1,nickname:!1,password:!1,confirm:!1,captcha:!1,mobile:!1,moblieCaptcha:!1},""!=e("#email").val()&&(authData.email=!0),""!=e("#nickname").val()&&(authData.nickname=!0),e("#captcha , #mcaptcha").val(""),e("#getMoblieCaptcha").removeAttr("disabled").text("获取验证码"),e("#register_submit").removeAttr("disabled"),e(".reVerifiy").focus(function(){var a=e(this).attr("id"),t=e(this).attr("tips")||"",s=e(this).siblings("em");s.replaceWith("<em>"+t+"</em>"),e(this).addClass("focus").removeClass("error"),"mobile"==a&&e("#getMoblieCaptcha").removeClass("registered")}).blur(function(){e(this).next().html(""),e(".reVerifiy").removeClass("focus"),e(this).val(e.trim(e(this).val())),e(this).next().parent().parent().removeClass("cur");var a=e(this).attr("id");if(e(".txtGreNum").val(1),"email"==a)""==this.value?authData.email=!1:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/.test(this.value)?(authData.email=!1,t("email",0)):(e(this).addClass("error"),e(this).next().show().replaceWith("<em class='txtRed'>Email格式不正确，请重新输入</em>"),authData.email=!1);else if("nickname"==a)if(""==e(this).val())authData.nickname=!1;else if(e(this).val().length<2)e(this).addClass("error"),e(this).next().replaceWith("<em class='txtRed'>昵称应为2-20个字符</em>"),authData.nickname=!1;else if(/^[\u4e00-\u9fa5]+$/.test(this.value)){var i=2*e(this).val().length;4>i?(e(this).addClass("error"),e(this).next().replaceWith("<em class='txtRed'>昵称应为2-20个字符</em>")):(authData.nickname=!1,t("nickname",1))}else/^[^\'\"\:;,\<\>\?\/\\\*\=\+\{\}\[\]\)\(\^%\$#\!`\s]+$/.test(e(this).val())?(authData.nickname=!1,t("nickname",1)):(e(this).addClass("error"),e(this).next().replaceWith("<em class='txtRed'>昵称不允许包含特殊字符或空格，请重新输入</em>"),authData.nickname=!1);else if("password"==a){if(""==e(this).val())authData.password=!1;else if(e(this).val().length<6)e(this).addClass("error"),e(this).next().replaceWith("<em class='txtRed'>密码长度应为6-16个字符</em>"),authData.password=!1;else if(""!=e(this).val()){var r=-1!=e(this).val().search(/[a-zA-Z]/)?1:0,l=-1!=e(this).val().search(/[0-9]/)?1:0,m=-1!=e(this).val().search(/[^A-Za-z0-9]/)?1:0,n=r+l+m;if(1==n){e(this).removeClass("error");var o="推荐数字、字母和符号组合的密码";e(this).parent().find("em").replaceWith('<em  class="txtRed" style="height:38px; width:410px; top:1px; background: url(/assets/v1/images/login/aj_03.jpg)  8px 3px  no-repeat; border:0;" ><span  style="line-height:40px;background:none;margin-left:64px;color:#666;font-style:normal;position:absolute;bottom:-4px;" >'+o+"</span></em>"),e("#safety").attr("value","1"),authData.password=!0}else if(2==n){e(this).removeClass("error");var o="推荐数字、字母和符号组合的密码";e(this).parent().find("em").replaceWith('<em  class="txtGre" style="height:38px; width:410px; top:1px; background: url(/assets/v1/images/login/aj_05.jpg)  8px 3px  no-repeat; "><span style="background:none;margin-left:70px;color:#666;font-style:normal;position:absolute;bottom:-4px;" >'+o+"</span></em>"),e("#safety").attr("value","2"),authData.password=!0}else if(3==n){var o="请牢记您的密码";e(this).parent().find("em").replaceWith('<em  class="txtGre" style="height:38px; width:410px; top:1px; background: url(/assets/v1/images/login/aj_07.jpg) 8px 3px no-repeat;"><span style="background:none;margin-left:70px;color:#666;font-style:normal;position:absolute;bottom:-4px;" >'+o+"</span></em>"),e("#safety").attr("value","3"),authData.password=!0}}}else"confirm"==a?e(this).val()==e("#password").val()&&""!=e(this).val()&&e(this).val().length>=6?(e(this).next().removeClass("txtRed").replaceWith("<em class='txtGre'></em>"),e(this).removeClass("error"),authData.confirm=!0):(e(this).addClass("error"),authData.confirm=!1,""==e(this).val()?e(this).removeClass("error"):e(this).next().replaceWith("<em class='txtRed'>两次输入密码不一致，请重新输入</em>")):"captcha"==a?""==e(this).val():"mobile"==a?""==this.value?authData.mobile=!1:/^1\d{10}$/.test(this.value)?(e(this).removeClass("error").next().show().replaceWith("<em class='txtGre'></em>"),authData.mobile=!0):(e(this).addClass("error"),e(this).next().show().replaceWith("<em class='txtRed'>手机号格式错误，请重新输入</em>"),authData.mobile=!1):"moblieCaptcha"==a&&(""==this.value?authData.moblieCaptcha=!1:6!=this.value.length?(e(this).addClass("error"),e(this).next().replaceWith("<em class='txtRed'>验证码错误，请重新输入</em>"),authData.moblieCaptcha=!1):s("moblieCaptcha"))}),e("#getMoblieCaptcha").click(function(){var a=e(this),t=e.trim(e("#mytoken").val()),s=e.trim(e("#mobile").val()),i=e.trim(e("#mcaptcha").val()),r=0;return s?a.hasClass("disabled")&&(e("#mcaptcha").addClass("error"),e("#mcaptcha").parents("li.input").find("em").replaceWith('<em class="txtRed">请输入验证码</em>')):(e("#mobile").addClass("error"),e("#mobile").parents("li.input").find("em").replaceWith('<em class="txtRed">请输入正确的手机号并验证</em>')),a.hasClass("disabled")?!1:void(/^1[3|4|5|7|8]\d{9}$/.test(s)&&(a.parents("li.input").find("em").replaceWith('<em class="txtLoad">正在验证...</em>'),e.ajax({url:"/member/sendRegisterMobileCaptcha.json",type:"GET",dataType:"jsonp",jsonp:"callback",data:{mobile:s,_hqb_token:t,captcha:i},success:function(t){200==t.code?(a.parents("li.input").find("em").replaceWith("<em>验证码已发送</em>"),authData.mobile=!0):12507==t.code?(r=1,e("#mobile").parents("li.input").find("em").replaceWith('<em class="txtRed">'+t.msg+"</em>"),a.parents("li.input").find("em").replaceWith("<em></em>"),authData.mobile=!1):(a.parents("li.input").find("em").replaceWith('<em class="txtRed">'+t.msg+"</em>"),authData.mobile=!1),r>0?a.addClass("registered").text("获取验证码"):(a.addClass("disabled"),_count=60,_setMCTimeOut(_count,a));var s=t.formToken||"";e("#mytoken").val(s)}})))}),window._setMCTimeOut=function(e,a){e>0?(a.text(e+"秒后重新获取"),setTimeout("_setMCTimeOut("+(e-1)+', $("#getMoblieCaptcha"))',1e3)):a.removeClass("disabled").text("获取验证码")},e("#captcha").keyup(function(){this.value.length>=4&&t("captcha",4)}),e("#mcaptcha").keyup(function(){e("#getMoblieCaptcha").hasClass("disabled")||e("#getMoblieCaptcha").addClass("disabled"),e(this).siblings("em").hasClass("txtGre")&&e(this).siblings("em").removeClass("txtGre"),this.value.length>=4&&t("mcaptcha",4)}),e("#hqb_protocol").click(function(){var a=e(this);a.parent().find("em").remove(),a.is(":checked")||a.parent().append('<em class="txtRed">请接受服务条款</em>')}),e("#register_submit").click(function(){if(r()&&a()){if(e(this).hasClass("submit-on"))return!1;e(this).addClass("submit-on"),e("form[name=register]").submit()}}),e(".regTypeTab div").click(function(){var a=e(this);a.hasClass("t_email")&&!a.hasClass("cur")?(e("#captcha" +
    "_img").attr("src","/captcha/captchaImage.html?s="+Math.random()),e("#registerForm").attr("data-type","email").attr("action","/member/create.html"),i("email")):a.hasClass("t_phone")&&!a.hasClass("cur")&&(e("#m_captcha_img").attr("src","/captcha/captchaImage.html?s="+Math.random()),e("#registerForm").attr("data-type","phone").attr("action","/member/mobileCreate.html"),i("phone")),e(".regTypeTab div").removeClass("cur"),a.addClass("cur")}),e(".server_agreement a").click(function(){art.dialog({title:"《华强北商城服务协议》",width:400,padding:"28px 28px",content:e("#registBot").html()})})});